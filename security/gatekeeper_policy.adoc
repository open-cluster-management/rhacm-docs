[#gatekeeper-policy]
= Integrating gatekeeper constraints and constraint templates

Gatekeeper is a validating webhook that enforces CustomResourceDefinition (CRD) based policies that are run with the Open Policy Agent (OPA). You can install gatekeeper on your cluster by using the gatekeeper operator policy. Gatekeeper policy can be used to evaluate Kubernetes resource compliance. You can leverage a OPA as the policy engine, and use Rego as the policy language.

The gatekeeper policy is created as a Kubernetes configuration policy in {product-title-short}. Gatekeeper policies include constraint templates (`ConstraintTemplates`), which are used to define specific constraints for your cluster. `ConstraintTemplates` informs which constraint template to enforce to the Gatekeeper. For more information, see the https://github.com/open-policy-agent/gatekeeper#gatekeeper[Gatekeeper].

{product-title-short} applies the following constraint templates in your {product-title-short} gatekeeper policy:

* link:https://github.com/open-cluster-management/policy-collection/blob/master/community/CM-Configuration-Management/policy-gatekeeper-sample.yaml#L83-L102[Admission constraint template]: Use the `policy-gatekeeper-admission` to check for misconfigurations that are created by the gatekeeper admission webhook:
+
[source,yaml]
----
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: policy-gatekeeper-admission
        spec:
          remediationAction: inform # will be overridden by remediationAction in parent policy
          severity: low
          object-templates:
            - complianceType: mustnothave
              objectDefinition:
                apiVersion: v1
                kind: Event
                metadata:
                  namespace: openshift-gatekeeper-system # set it to the actual namespace where gatekeeper is running if different
                  annotations:
                    constraint_action: deny
                    constraint_kind: K8sRequiredLabels
                    constraint_name: ns-must-have-gk
                    event_type: violation
----

* link:https://github.com/open-cluster-management/policy-collection/blob/master/community/CM-Configuration-Management/policy-gatekeeper-sample.yaml#L66-L82[Audit constraint template]: Use the `policy-gatekeeper-audit` to periodically check and evaluate existing resources against the gatekeeper policies that are enforced to detect exisiting miscongfigurations. 
+
[source,yaml]
----
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: policy-gatekeeper-audit
        spec:
          remediationAction: inform # will be overridden by remediationAction in parent policy
          severity: low
          object-templates:
            - complianceType: musthave
              objectDefinition:
                apiVersion: constraints.gatekeeper.sh/v1beta1
                kind: K8sRequiredLabels
                metadata:
                  name: ns-must-have-gk
                status:
                  totalViolations: 0
----


Learn how to integrate gatekeeper operator policy to install gatekeeper and create a {product-title-short} gatekeeper policy, see xref:../security/create_gatekeeper.adoc#gatekeeper-policy-operator-integration[Integrating gatekeeper operator policy] for more details. Refer to xref:../security/grc_intro.adoc#governance-and-risk[Governance and risk] for more topics on the security framework.
