[#managing-gatekeeper-operator-policies]
= Managing gatekeeper operator policies

Use the gatekeeper operator policy to install the gatekeeper operator and gatekeeper on a managed cluster. Learn to create, view, and update your gatekeeper operator policies in the following sections.

*Required access*: Cluster administrator

[#install-gatekeeper-operator-policy]
== Installing gatekeeper using a gatekeeper operator policy

Use the governance framework to install the gatekeeper operator. Gatekeeper operator is available in the {ocp-short} catalog. See _Adding Operators to a cluster_ in the link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.6/html/operators/administrator-tasks#olm-adding-operators-to-a-cluster[{ocp-short} documentation] for more information.

Use the configuration policy controller to install the gatekeeper operator policy. During the install, the operator group and subscription pull the gatekeeper operator to install it in your managed cluster. Then, the gatekeeper operator creates a gatekeeper CR to configure gatekeeper. View the  <<gatekeeper-operator-sample,Gatekeeper operator CR>> sample.

Gatekeeper operator policy is monitored by the {product-title-short} configuration policy controller, where `enforce` remediation action is supported. Gatekeeper operator policies are created automatically by the controller when set to `enforce`.


[#creating-a-gatekeeper-policy-from-the-console]
== Creating a gatekeeper policy from the console

Complete the following steps to install the gatekeeper operator policy from the console:

. Log in to your cluster.
. From the navigation menu, click *Govern risk*.
. Create a policy by selecting *Create policy*.
. As you complete the form, select *GatekeeperOperator* from the _Specifications_ field. The parameter values for your policy are automatically populated and the policy is set to enforce to install gatekeeper. See https://github.com/open-cluster-management/policy-collection/blob/master/community/CM-Configuration-Management/policy-gatekeeper-operator.yaml[policy-gatekeeper-operator.yaml] to view an the sample.
+
*Note:* Consider that default values can be generated by the operator. See link:https://github.com/open-policy-agent/gatekeeper/blob/master/charts/gatekeeper/README.md[Gatekeeper Helm Chart] for an explanation of the optional parameters that can be used for the gatekeeper operator policy.  

[#gatekeeper-operator-sample]
=== Gatekeeper operator CR

[source,yaml]
----
apiVersion: operator.gatekeeper.sh/v1alpha1
kind: Gatekeeper
metadata:
  name: gatekeeper
spec:
  # Add fields here
  image:
    image: docker.io/openpolicyagent/gatekeeper:v3.2.2
    imagePullPolicy: Always
  audit:
    replicas: 1
    logLevel: DEBUG
    auditInterval: 10s
    constraintViolationLimit: 55
    auditFromCache: Enabled
    auditChunkSize: 66
    emitAuditEvents: Enabled
    resources:
      limits:
        cpu: 500m
        memory: 150Mi
      requests:
        cpu: 500m
        memory: 130Mi
  validatingWebhook: Enabled
  webhook:
    replicas: 2
    logLevel: ERROR
    emitAdmissionEvents: Enabled
    failurePolicy: Fail
    resources:
      limits:
        cpu: 480m
        memory: 140Mi
      requests:
        cpu: 400m
        memory: 120Mi
  nodeSelector:
    region: "EMEA"
  affinity:
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchLabels:
              auditKey: "auditValue"
          topologyKey: topology.kubernetes.io/zone
  tolerations:
    - key: "Example"
      operator: "Exists"
      effect: "NoSchedule"
  podAnnotations:
    some-annotation: "this is a test"
    other-annotation: "another test"
----

[#updating-gatekeeper-operator-policy]
== Updating gatekeeper operator policy

Learn to update the gatekeeper operator policy by viewing the following section.

[#viewing-gatekeeper-operator-policy-from-the-console]
=== Viewing gatekeeper operator policy from the console

You can view your gatekeeper operator policy and its status from the console.

. Log in to your cluster from the console.
. From the navigation menu, click *Govern risk* to view a table list of your policies.
+
*Note*: You can filter the table list of your policies by selecting the _Policies_ tab or _Cluster violations_ tab.

. Select the `policy-gatekeeper-operator` policy to view more details.
. View the policy violations by selecting the _Status_ tab.

[#disabling-gatekeeper-operator-policy]
=== Disabling gatekeeper operator policy

Complete the following steps to disable your gatekeeper operator policy:

. Log in to your {product-title} console.
. From the navigation menu, click *Govern risk* to view a table list of your policies.
. Disable your policy by clicking the *Actions* icon > *Disable*.
The _Disable Policy_ dialog box appears.
. Click *Disable policy*.

Your policy is disabled.

[#deleting-gatekeeper-operator-policy]
=== Deleting gatekeeper operator policy

Delete the gatekeeper operator policy from the CLI or the console.

* Delete gatekeeper operator policy from the CLI:
 .. Delete gatekeeper operator policy by running the following command:
+
----
kubectl delete policy <policy-gatekeeper-operator-name> -n <mcm namespace>
----
+
After your policy is deleted, it is removed from your target cluster or clusters.

 .. Verify that your policy is removed by running the following command:
+
----
kubectl get policy <policy-gatekeeper-operator-name> -n <mcm namespace>
----

* Delete gatekeeper operator policy from the console:
 .. From the navigation menu, click *Govern risk* to view a table list of your policies.
 .. Click the *Actions* icon for the `policy-gatekeeper-operator` policy to delete in the policy violation table.
 .. Click *Remove*.
 .. From the _Remove policy_ dialog box, click *Remove policy*.

Your gatekeeper operator policy is deleted.

See xref:../gatekeeper_policy.adoc#gatekeeper-policy[Integrating gatekeeper constraints and constraint templates] for details about gatekeeper. For a list of topics to integrate third-party policies with the product, see xref:../security/third_party_policy.adoc#integrate-third-party-policies[Integrate third-party policies]. 

